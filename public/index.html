<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        html {
            font-family: monospace
        }

        #wsCanvas {
            float: left;
            border: 1px solid black;
            margin: 10px;
        }

    </style>
</head>

<body>
    <div>
        <canvas id="wsCanvas" width=400 height=400></canvas>
    </div>

    <script type="text/javascript">
        //const url = "ws:localhost:8080"
        const url = "ws:fast-harbor-60324.herokuapp.com"
        window.onload = function(e) {
            console.log("Starting...");

            const canvas = document.getElementById("wsCanvas");
            console.log(canvas);
            const drawingContext = canvas.getContext("2d");
            drawingContext.fillStyle = "rgba(0, 0, 0, 1)"

            var serverSocket = new WebSocket(url);
            serverSocket.onopen = function (event) {
                console.log("Server socket opened!")
            };
            serverSocket.onmessage = function (event) {
                console.log("Received " + event.data);

                // interpret message here
                messageObject = JSON.parse(event.data);
                const x = messageObject.x;
                const y = messageObject.y;
                const xPrevious = messageObject.xPrevious;
                const yPrevious = messageObject.yPrevious;


                if (xPrevious == -1) {
                    drawingContext.beginPath();
                    drawingContext.arc(x, y, 2.5, 0, 2 * Math.PI, false);
                    drawingContext.fill();
                } else {
                    drawingContext.beginPath();
                    drawingContext.arc(xPrevious, yPrevious, 2.5, 0, 2 * Math.PI, false);
                    drawingContext.fill();

                    drawingContext.beginPath();
                    drawingContext.moveTo(xPrevious, yPrevious);
                    drawingContext.lineTo(x, y);
                    drawingContext.lineWidth = 5;
                    drawingContext.stroke();

                    drawingContext.beginPath();
                    drawingContext.arc(x, y, 2.5, 0, 2 * Math.PI, false);
                    drawingContext.fill()
                }
            };

            var isDrawing = false
            var xPrevious = -1;
            var yPrevious = -1;
            canvas.addEventListener('mousedown', e => {
                isDrawing = true;

                serverSocket.send(JSON.stringify({
                    xPrevious: -1,
                    yPrevious: -1,
                    x: e.offsetX,
                    y: e.offsetY
                }));

                xPrevious = e.offsetX;
                yPrevious = e.offsetY;
            });

            canvas.addEventListener('mouseup', e => {
                isDrawing = false;
                xPrevious = -1;
                yPrevious = -1;
            });

            canvas.addEventListener('mousemove', e => {
                if (isDrawing) {
                    serverSocket.send(JSON.stringify({
                        xPrevious: xPrevious,
                        yPrevious: yPrevious,
                        x: e.offsetX,
                        y: e.offsetY
                    }));

                    xPrevious = e.offsetX;
                    yPrevious = e.offsetY;
                }
            });
        };

    </script>
</body>
</html>
