<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        html {
            font-family: monospace
        }

        #wsCanvas {
            float: left;
            border: 1px solid black;
            margin: 10px;
        }

        .appContainer {
            width: 100%;
            float: left;
        }

    </style>
</head>

<body>
    <div class="appContainer">
        <label for="InputColor">Color</label>
        <input type="color" id="inputColor" name="InputColor" value="#000000">

        <label for="InputDiameter">Brush Size</label>
        <input type="range" id="inputDiameter" name="InputDiameter" value="5">
    </div>

    <div class="appContainer">
        <canvas id="wsCanvas" width=400 height=400></canvas>
    </div>

    <script type="text/javascript">
        //const url = "ws:localhost:8080"
        const url = "wss:fast-harbor-60324.herokuapp.com"
        window.onload = function(e) {
            console.log("Starting...");

            const canvas = document.getElementById("wsCanvas");
            const colorPicker = document.getElementById("inputColor");
            const radiusPicker = document.getElementById("inputColor");
            console.log(canvas);
            const drawingContext = canvas.getContext("2d");

            var serverSocket = new WebSocket(url);
            serverSocket.onopen = function (event) {
                console.log("Server socket opened!")
            };
            serverSocket.onmessage = function (event) {
                //console.log("Received " + event.data);

                // interpret message here
                messageObject = JSON.parse(event.data);
                const x = messageObject.x;
                const y = messageObject.y;
                const xPrevious = messageObject.xPrevious;
                const yPrevious = messageObject.yPrevious;
                const color = messageObject.color;
                const diameter = messageObject.diameter;
                const radius = messageObject.diameter / 2;

                drawingContext.fillStyle = color;
                drawingContext.strokeStyle = color;

                if (xPrevious == -1) {
                    drawingContext.beginPath();
                    drawingContext.arc(x, y, radius, 0, 2 * Math.PI, false);
                    drawingContext.fill();
                } else {
                    drawingContext.beginPath();
                    drawingContext.arc(xPrevious, yPrevious, radius, 0, 2 * Math.PI, false);
                    drawingContext.fill();

                    drawingContext.beginPath();
                    drawingContext.moveTo(xPrevious, yPrevious);
                    drawingContext.lineTo(x, y);
                    drawingContext.lineWidth = diameter;
                    drawingContext.stroke();

                    drawingContext.beginPath();
                    drawingContext.arc(x, y, radius, 0, 2 * Math.PI, false);
                    drawingContext.fill()
                }
            };

            var isDrawing = false
            var xPrevious = -1;
            var yPrevious = -1;
            canvas.addEventListener('mousedown', e => {
                isDrawing = true;

                serverSocket.send(JSON.stringify({
                    xPrevious: -1,
                    yPrevious: -1,
                    x: e.offsetX,
                    y: e.offsetY,
                    color: inputColor.value,
                    diameter: inputDiameter.value
                }));

                xPrevious = e.offsetX;
                yPrevious = e.offsetY;
            });

            canvas.addEventListener('mouseup', e => {
                isDrawing = false;
                xPrevious = -1;
                yPrevious = -1;
            });

            canvas.addEventListener('mousemove', e => {
                if (isDrawing) {
                    serverSocket.send(JSON.stringify({
                        xPrevious: xPrevious,
                        yPrevious: yPrevious,
                        x: e.offsetX,
                        y: e.offsetY,
                        color: inputColor.value,
                        diameter: inputDiameter.value
                    }));

                    xPrevious = e.offsetX;
                    yPrevious = e.offsetY;
                }
            });
        };

    </script>
</body>
</html>
